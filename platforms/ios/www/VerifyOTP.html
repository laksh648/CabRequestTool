<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" language="JavaScript">
function sendOTP(){
	var employeeMobile = window.localStorage.getItem("EmployeeMobileNumber");
	//alert('OTP Processing'+employeeMobile);
	$.getJSON("https://control.msg91.com/api/sendotp.php?authkey=184935A4LBWvyI8PW5a1553ce&mobile="+employeeMobile+"&message=&sender=OTPSMS&otp=&otp_expiry=1&otp_length=4", function (data) {
    		//alert(data.message);
    		//alert('OTP Sent success');
	}).catch(function (jqXHR, textStatus, errorThrown)
	{
			alert('OTP send failed');
	});
}
</script>
<script type="text/javascript" language="JavaScript">
function verifyOTP(){
	var employeeMobile = window.localStorage.getItem("EmployeeMobileNumber");
	var otp = $('#OTPTextField').val();
	alert('verifyOTP Processing'+otp);
    $.getJSON("https://control.msg91.com/api/verifyRequestOTP.php?authkey=184935A4LBWvyI8PW5a1553ce&mobile="+employeeMobile+"&otp="+otp, function (data) {
    	window.location = "CabRequestForm.html";
	}).catch(function (jqXHR, textStatus, errorThrown) {
		alert('Verify OTP Failed');
	});
}
</script>
</head>

<body>
<label id="mobile_no"> OTP is sent on </label><br/>
<input type="number" name="OTPTextField" id='OTPTextField'>
<button onclick="verifyOTP()">Verify OTP</button>
<script type="text/javascript" language="JavaScript">
	//var employeeDetail = window.localStorage.getItem("employee_details");
	var db = window.openDatabase("CabRequest", "1.0", "Cab-request tool database", 1000000);
	db.transaction(fetchEmployeeDetails, errorCB, successCB);
	//alert("fetchEmployeeDetails !");
	function fetchEmployeeDetails(tx){
    	tx.executeSql('SELECT * FROM employees',[],querySuccess,errorCB);
	}
	function querySuccess(tx,result) {
 		//alert("querySuccess fetchEmployeeDetails");
 		$.each(result.rows,function(index){
            var row = result.rows.item(index);
            var mobileValue = row['mobile_no'];
            window.localStorage.setItem("EmployeeMobileNumber", mobileValue);
            document.getElementById('mobile_no').innerHTML += mobileValue;
        });
	}

	function errorCB(err) {
 		alert("Error errorCB fetchEmployeeDetails processing SQL: "+err.code+err.message);
	}

	function successCB() {
 		//alert("success fetchEmployeeDetails SQL!");
	}	
	sendOTP();
</script>
</body>
</html>